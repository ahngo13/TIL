# 수업 12/2

박창렴 강사님. 오픈이지 이사
http://bit.ly/2P6ADvW - 내용 공유

##신입 - 용어를 빨리 알아들어야 한다.

### 참고자료

#### 개발관련 참고자료를 얻을 수 있는 곳
MDN ⇒ https://developer.mozilla.org/ko/
html, css, javascript 학습자능. 용어 검색 가능.

생활코딩 ⇒ https://opentutorials.org/course/1
유튜브 영상 있음, JAVA, Oracle, React, Javascript, css, html, mysql, ajax, php&mysql 등등

#### 개발보안 또는 시큐어코딩 관련 자료를 얻을 수 있는 곳
SW개발보안가이드 ⇒ https://www.kisa.or.kr/public/laws/laws3_View.jsp?cPage=6&mode=view&p_No=259&b_No=259&d_No=88
거의 400Page 분량

Java 시큐어코딩 가이드 / C 시큐어코딩 가이드 … ⇒ https://www.kisa.or.kr/public/laws/laws3.jsp
둘다 200Page 분량

#### 블록체인
돈텝스코 블록체인 TED 강의 ⇒ https://www.ted.com/talks/don_tapscott_how_the_blockchain_is_changing_money_and_business?language=ko
자본주의 1부 - 돈은 빚이다. ⇒ http://www.ebs.co.kr/tv/show?prodId=348&lectId=3121167

##### 블록체인 기본서
블록체인 무엇인가? ⇒ http://www.yes24.com/Product/
Goods/58551591?scode=032&OzSrank=1
300Page 분량
블록체인 혁명 ⇒ http://www.yes24.com/Product/Goods/67567126?scode=032&OzSrank=1
600Page 분량
비트코인과 블록체인, 탐욕이 삼켜버린 기술 ⇒ http://www.yes24.com/Product/Goods/58149507?Goods/58149507?scode=032&OzSrank=1
360Page 분량

##### 블록체인 코어 (비트코인, 이더리움)
비트코인, 공개 블록체인 프로그래밍 http://www.yes24.com/Product/
Goods/67090202?scode=032&OzSrank=9
코어 이더리움 http://www.yes24.com/Product/Goods/59621522?scode=032&OzSrank=1

##### 이더리움 관련

Mastering Ethereum Git https://github.com/ethereumbook/ethereumbook
영문으로 되어 있음.
블록체인 애플리케이션 개발 실전 입문 http://www.yes24.com/Product/
Goods/57287123?scode=032&OzSrank=31

##### 하이퍼렛져 관련
하이퍼레저 블록체인 개발 http://www.yes24.com/Product/
Goods/69279313?scode=032&OzSrank=6
하이퍼렛져 기술을 활용해 블록체인 네트워크를 구축하는 지식을 다루는 참고서

##### 온라인 강좌
https://lisk.io/academy/welcome-to-the-lisk-academy
영어로 되어 있음.



######  서버 사이드 스크립트 언어
웹에서 사용되는 스크립트 언어 중에서 서버 사이드에서 실행되는 스크립트 언어를 말함.
서버와 클라이언트는 상호 통신을 한다. 브라우저를 켜고 특정 웹사이트에 접속을 하려고 하면 클라이언트에서 요청이 서버로 가고, 서버에서 해당 페이지를 응답해준다. 서버와 클라이언트가 통신을 한다. 이때 서버 측에 있는 프로그램을 서버 사이드 프로그램이라고 한다.
서버 사이드 프로그램은 클라이언트로 전송이 안되는 부분이며, 보안적인 측면에서도 리스크가 있어서 클라이언트로 오지 않는다. 스크립트 언어 특성상 코드가 그대로 노출이 된다. 브라우저에서 소스 보기 기능을 제공한다. 클라이언트 코드의 경우는 바로 볼 수가 있다. 서버 코드는 클라이언트로 전송되지 않아서 볼 수는 없다. 이러한 서버 사이드 스크립트 개발은 스크립트 언어의 장점인 개발이 쉽다는 점을 장점으로 가진다.
스크립트의 특성상 복잡한 로직 개발에는 어려움이 있을 수 있다.

###### 대표적인 서버 사이드 스크립트 언어
ASP/ASP.NET
PHP
파이썬
루비
JSP
Node.js

###### 자바스크립트 프레임워크 3대장
자바스크립트 프레임워크 : 자바스크립트를 쉽게 사용하기 위한 서비스

1. Vue.js

2. React.js

3. Angular.js

   

### 인프라란?

애플리케이션을 가동시키기 위해 필요한 하드웨어나 OS, 미들웨어, 네트워크 등 시스템의 기반을 말합니다.
### 개발자에게 인프라 지식이 필요한 이유

예전에는 데이터센터나 서버실에 서버를 직접 두고 관리하던 On-Premise 방식이었기 때문에 물리적 서버를
담당하는 엔지니어가 따로 존재했음.
그러나 최근에는 Cloud 방식으로 넘어오게 되면서 개발자가 배포나 테스트 등을 직접 할 수 있게 되었고 이로인해서인프라 관련 지식이 필요하게 되었습니다.

### 인프라 구성요소

#### Hardware, HW
서버 장비 본체나 데이터를 저장하기 위한 스토리지, 전원 장치
#### Network
사용자가 원격으로 접근할 수 있도록 서버를 연결하는 도구들
#### Operating System, OS
하드웨어와 네트워크 장비를 제어하기 위한 기본적인 소프트웨어
#### Client OS(Windows, macOS 등)
#### Server OS(Linux, Unix, Windows Server 등)
#### Middleware
서버 상에서 서버가 특정 역할을 하도록 기능을 제공하는 소프트웨어
#### Web Server
##### 1)하드웨어
Web 서버 설치되어 있는 컴퓨터
##### 2)소프트웨어
웹 브라우저 클라이언트로부터 HTTP 요청을 받아 정적인 컨텐츠(.html, .jpeg .css 등)를 제공하는 컴퓨터 프로그램

###### WAS(Web Application Server)
DB조회나 다양한 로직 처리를 요구하는 동적인 컨텐츠를 제공하기 위해 만들어진 Application Server
HTTP를 통해 컴퓨터나 장치에 애플리케이션을 수행해주는 미들웨어이다.
웹 컨테이너, 서블릿 컨테이너라고도 불린다.

###### Node.js (백엔드)
확장성 있는 네트워크 애플리케이션(서버 사이드) 개발에 사용되는 소프트웨어 플랫폼
자바스크립트를 활용하며 높은 처리 성능을 가지고 있다.
내장 HTTP 서버 라이브러리를 포함하고 있어 아파치 등의 별도의 소프트웨어 없이 동작하는 것이 가능하면 웹 서버의 동작에 있어 더 많은 통제를 가능케 한다.
시큐어코딩 = 룰 => 안전한 SW => 보안 내재화
구현단계에서 안전한 소스코드가 나오도록 47개의 보안약점을 보완

###### 애자일(Agile)
작업 계획을 짧은 단위로 세우고 시제품을 만들어 나가는 사이클을 반복함으로써 고객의 요구 변화에
유연하고도 신속하게 대응하는 개발 방법론
공급망 보안
오픈소스 기반의 프로젝트 활동이 많아지면서 github같은 공급망 쪽에서 보안도 중요해짐.

실습 프로그램 다운로드
https://drive.google.com/file/d/0B6O3fRoAooHJeU1OT2kwdjVPS0U/view?usp=sharing
블록체인 기본 취지는 공유이지만 비즈니스는 private하게 사용함.

### HTTP 요청, 응답 구조

connectionless = stateless(요청 관계를 알 수 없다) => sessionless
연결관리, 상태관리 하지 않는다.
요청하지 않아도 응답을 하는 경우가 있음.
푸시, 팝업, 배너, 채팅 등
연결 : 3way hand shaking
SYN - SYN/ACK - ACK
해제 : 4way hand shaking
FIN - FIN/ACK - FIN - FIN/ACK
쿠키(cookie) : 비연속성을 보완, 서버의 자취 => 세션(session)
다운받은 파일을 실행해서 압축해제
netcat 프로그램 다운로드 후 압축해제
https://eternallybored.org/misc/netcat/netcat-win32-1.11.zip
C:\SecureCoding\start_securecoding.bat 실행 → MySQL 서비스 실행, Eclipse 실행
이클립스 > Server 탭 > Tomcat 선택 > 벌레 모양 아이콘 (디버그 모드로 실행) 클릭
만약에 오류가 발생한 경우, 아래와 같이 한 후 위의 동작을 반복
netcat 프로그램 다운로드 후 압축해제
https://eternallybored.org/misc/netcat/netcat-win32-1.11.zip
브라우저를 실행한 후 http://localhost:8080/openeg 로 접속
C:\SecureCoding\web vulnerability tools\burpsuit_start.bat 파일을 메모장으로 연 후 아래 내용을
수정, 저장, 실행
set path=C:\securecoding\tools\jdk1.7.0_75\bin\
프록시의 리스닝 포트를 9090으로 변경
Running checkbox를 체크
시작 메뉴에서 프록시 설정 메뉴를 검색해서 실행

C:\SecureCoding\web vulnerability tools\HackerFox-with-Firefox-version-2.0.0.20.zip 파일을
압축해제
압축해제한 폴더에 TheHackerFireFox.exe 파일을 실행
http://localhost:8080/openeg 로 접속
netcat 프로그램 다운로드 후 압축해제
https://eternallybored.org/misc/netcat/netcat-win32-1.11.zip
IDE : 통합 개발 환경
perspective
client - proxy - server

### 프록시

클라이언트와 서버 중간에 끼어서 캐싱이나 모니터링 하는 역할.
1) 캐싱
2) 모니터링 -> 통제
대표적인 프록시 도구
fiddler, paros, burp suite
1) 실행
2) 네트워크 설정

식별 -> 인증 -> 인가(행위에 대한 권한이 있다 없다)

인증 타입
1) 지식 : 패스워드
2) 소유 : 인증서
3) 특징 : 생체적인 특징(바이오 인증), 필기체 서명
이중 인증 - 2 factor
다중 인증 - multi factor
인가
1)화면 : 권한이 없으면 안 보임.
2)기능 : 권한이 있는 경우에만 기능 제공.
3)데이터 : 데이터를 위한 접근 통제.
openeg라는 파일을 요청. -> openeg/ 디렉터리를 요청. -> 기본페이지가 있는지 확인. -> 없으면 디렉토리
리스팅 옵션(활성화 되어있으면 안됨, 서버의 자원이 노출됨)
#1 입력값이 전달과정과 내부처리 과정에서 변경 없이 그대로 사용되는지 확인
=> 내부 로직을 조작하는 문자열을 추가
[사용자가 화면을 통해서 값을 입력]
아이디 : aaa'
패스워드 : bbb'
[요청 파라미터를 통해서 서버로 전달]
../login.do?id=aaa&pw=bbb
[전달받을 값을 이용하여 쿼리와 같은 내부 로직을 실행]
select * from users where id = 'aaa'' and pw = 'bbb''
-> 일치하는 데이터가 있으면 -> 로그인 성공
-> 일치하는 데이터가 없으면 -> 로그인 실패
= 오류 페이지 -> MySQL server version for the right syntax to use near 'bbb''' at line 1
-> 정보를 수집 => 입력한 값이 전달 및 사용 과정에서 변경이 일어나지 않음을 확인
의미 문자(meta 문자)
SQL문 '(홑따옴표) -> 문자열의 시작과 끝을 나타냄.
ex) where name = 'John￦'s'
escape 의미를 없애고 그 자체로 인식되도록 한다. (역슬래시, ￦, 홑따옴표 2개 '')
URL & -> 파라미터 구분자로서의 의미를 나타냄.
ex) name=bandi&Luice&age=23(ASCII code %26로 &를 나타냄)
#2 MySQL 서버의 특징을 이용한 공격
[사용자가 화면을 통해서 값을 입력]
아이디 : aaa' #
패스워드 : bbb' #
[요청 파라미터를 통해서 서버로 전달]
../login.do?id=aaa' #&pw=bbb' #
[전달받을 값을 이용하여 쿼리와 같은 내부 로직을 실행]
select * from users where id = 'aaa' #' and pw = 'bbb' #'
#은 MySQL에서 주석처리
-> 식별 정보만(ID)으로 로그인이 가능
SQL Injection (삽입) 취약점을이용한 인증과정 우회
입력값에 쿼리 조작 문자열 포함 여부를 확인하지 않고 쿼리문 생성 및 실행에 사용하는 경우 발생
-> 쿼리의 구조와 의미를 변경해서 실행
-> 권한 밖의 데이터 접근이 가능
-> DBMS 서버의 쉘을 획득하여 원격에서 제어
-> 쿼리를 통해서 제공되는 기능을 우회
회원가입 페이지를 통해서 확인한 admin 계정으로 로그인 시도
[사용자가 화면을 통해서 값을 입력]
아이디 : admin' #
패스워드 : bbb' #
[요청 파라미터를 통해서 서버로 전달]
../login.do?id=admin' #&pw=bbb' #
[전달받을 값을 이용하여 쿼리와 같은 내부 로직을 실행]
select * from users where id = 'admin' #' and pw = 'bbb' #'
[방어기법]
1) 정적 쿼리가 실행되도록 한다. => 항상 동일한 형태의 쿼리가 실행되는 것을 보장

- 제공해주는 프레임워크(ORM) 또는 라이브러리(PreparedStatement) 등을 활용(권장)
- 개발자가 직접 구현(어리석은 짓)
2) 동적 쿼리를 사용해야 하는 경우에는 입력값을 검증 후 사용한다.
입력 -> 처리 -> 출력
1) 안전 O => 계획/의도한 대로 처리
2) 안전 X(사용자 입력) => 검증 후 처리에 사용
- 형식 검증 숫자만 영문만
- 내용 검증 ' #
3) 에러 메세지에 시스템 정보가 포함되지 않도록 한다.
4) 어플리케이션에서 사용하는 DB 사용자의 권한을 최소한으로 부여한다.
3, 4번은 SQL삽입 공격을 직접적으로 방어하는 방법은 아니며, 공격이 확대되는 것을 완화시키는 방법
FireFox > Tools > Live HTTP Headers 실행
> http://localhost:8080/WebGoat 접속 (계정 : webgoat / webgoat)
> http://localhost:8080/WebGoat
> GET /WebGoat HTTP/1.1 ⇐ WebGoat 파일을 요청
> Host: localhost:8080
> User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.2; en-US; rv:1.8.1.20) Gecko/20081217
> Firefox/2.0.0.20
> Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/
> png,*/*;q=0.5
> Accept-Language: en-us,en;q=0.5
> Accept-Encoding: gzip,deflate
> Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
> Keep-Alive: 300
> Connection: keep-alive
> HTTP/1.1 302 Moved Temporarily ⇐ 디렉터리 요청으로 리다이렉트
> Server: Apache-Coyote/1.1
> Location: http://localhost:8080/WebGoat/
> Transfer-Encoding: chunked
> Date: Mon, 02 Dec 2019 08:37:46 GMT
----------------------------------------------------------
http://localhost:8080/WebGoat/
GET /WebGoat/ HTTP/1.1 ⇐ 서버로부터 전달받은 리다이렉트 주소로 다시 요청
Host: localhost:8080
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.2; en-US; rv:1.8.1.20) Gecko/20081217
Firefox/2.0.0.20
Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/
png,*/*;q=0.5
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive
HTTP/1.1 401 Unauthorized ⇐ WebGoat/ 디렉터리에 있는 기본 페이지를 제공할려고 하는데,
Server: Apache-Coyote/1.1 인증되지 않아서 제공할 수 없음
Pragma: No-cache
Cache-Control: no-cache
Expires: Thu, 01 Jan 1970 09:00:00 KST
WWW-Authenticate: Basic realm="WebGoat Application" ⇐ 기본 인증 방식으로 인증 정보를 요청
Content-Type: text/html;charset=utf-8
Content-Length: 954

Date: Mon, 02 Dec 2019 08:37:46 GMT

⇐ (브라우저가) 사용자에게 username과 password를 입력하는 창을 제공
http://localhost:8080/WebGoat/
GET /WebGoat/ HTTP/1.1
Host: localhost:8080
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.2; en-US; rv:1.8.1.20) Gecko/20081217
Firefox/2.0.0.20
Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/
png,*/*;q=0.5
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive
Authorization: Basic d2ViZ29hdDp3ZWJnb2F0 ⇐ 인증 정보를 전달
→ username:password 형식의 값이 BASE64로 인코딩
HTTP/1.1 200 OK ⇐ 요청한 자원을 응답
Server: Apache-Coyote/1.1
Pragma: No-cache
Cache-Control: no-cache
Expires: Thu, 01 Jan 1970 09:00:00 KST
Accept-Ranges: bytes
Etag: W/"138-1397619190000"
Last-Modified: Wed, 16 Apr 2014 03:33:10 GMT
Content-Type: text/html
Content-Length: 138

Date: Mon, 02 Dec 2019 08:37:58 GMT

http://localhost:8080/WebGoat/attack
GET /WebGoat/attack HTTP/1.1
Host: localhost:8080
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.2; en-US; rv:1.8.1.20) Gecko/20081217
Firefox/2.0.0.20
Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/
png,*/*;q=0.5
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive
Authorization: Basic d2ViZ29hdDp3ZWJnb2F0
HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
Pragma: No-cache
Cache-Control: no-cache
Expires: Thu, 01 Jan 1970 09:00:00 KST
Set-Cookie: JSESSIONID=2B21EFCAA77D2C35F5CF6718B460C4F2; Path=/WebGoat
Content-Type: text/html;charset=ISO-8859-1
Content-Length: 4183

Date: Mon, 02 Dec 2019 08:37:58 GMT

http://localhost:8080/WebGoat/css/webgoat.css
GET /WebGoat/css/webgoat.css HTTP/1.1
Host: localhost:8080
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.2; en-US; rv:1.8.1.20) Gecko/20081217
Firefox/2.0.0.20
Accept: text/css,*/*;q=0.1
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive
Referer: http://localhost:8080/WebGoat/attack
Cookie: JSESSIONID=2B21EFCAA77D2C35F5CF6718B460C4F2
Authorization: Basic d2ViZ29hdDp3ZWJnb2F0
HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
Pragma: No-cache
Cache-Control: no-cache
Expires: Thu, 01 Jan 1970 09:00:00 KST
Set-Cookie: JSESSIONID=A333B203354912E891224B94B43AC6FB; Path=/WebGoat
Accept-Ranges: bytes
Etag: W/"4182-1379910546000"
Last-Modified: Mon, 23 Sep 2013 04:29:06 GMT
Content-Type: text/css
Content-Length: 4182

Date: Mon, 02 Dec 2019 08:37:58 GMT

http://localhost:8080/WebGoat/images/logos/owasp.jpg
GET /WebGoat/images/logos/owasp.jpg HTTP/1.1
Host: localhost:8080
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.2; en-US; rv:1.8.1.20) Gecko/20081217
Firefox/2.0.0.20
Accept: image/png,*/*;q=0.5
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive
Referer: http://localhost:8080/WebGoat/attack
Cookie: JSESSIONID=A333B203354912E891224B94B43AC6FB
Authorization: Basic d2ViZ29hdDp3ZWJnb2F0
HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
Pragma: No-cache
Cache-Control: no-cache
Expires: Thu, 01 Jan 1970 09:00:00 KST
Accept-Ranges: bytes
Etag: W/"3565-1379910546000"
Last-Modified: Mon, 23 Sep 2013 04:29:06 GMT
Content-Type: image/jpeg
Content-Length: 3565

Date: Mon, 02 Dec 2019 08:37:58 GMT

http://localhost:8080/WebGoat/images/logos/aspect.jpg
GET /WebGoat/images/logos/aspect.jpg HTTP/1.1
Host: localhost:8080
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.2; en-US; rv:1.8.1.20) Gecko/20081217
Firefox/2.0.0.20
Accept: image/png,*/*;q=0.5
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive
Referer: http://localhost:8080/WebGoat/attack
Cookie: JSESSIONID=A333B203354912E891224B94B43AC6FB
Authorization: Basic d2ViZ29hdDp3ZWJnb2F0
HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
Pragma: No-cache
Cache-Control: no-cache
Expires: Thu, 01 Jan 1970 09:00:00 KST
Accept-Ranges: bytes
Etag: W/"21900-1379910546000"
Last-Modified: Mon, 23 Sep 2013 04:29:06 GMT
Content-Type: image/jpeg
Content-Length: 21900

Date: Mon, 02 Dec 2019 08:37:58 GMT

http://localhost:8080/WebGoat/images/header/header.jpg
GET /WebGoat/images/header/header.jpg HTTP/1.1
Host: localhost:8080
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.2; en-US; rv:1.8.1.20) Gecko/20081217
Firefox/2.0.0.20
Accept: image/png,*/*;q=0.5
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive
Referer: http://localhost:8080/WebGoat/css/webgoat.css
Cookie: JSESSIONID=A333B203354912E891224B94B43AC6FB
Authorization: Basic d2ViZ29hdDp3ZWJnb2F0
HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
Pragma: No-cache
Cache-Control: no-cache
Expires: Thu, 01 Jan 1970 09:00:00 KST
Accept-Ranges: bytes
Etag: W/"96496-1379910546000"
Last-Modified: Mon, 23 Sep 2013 04:29:06 GMT
Content-Type: image/jpeg
Content-Length: 96496

Date: Mon, 02 Dec 2019 08:37:58 GMT

아이디/패스워드가 base64로 인코딩 되기 때문에 보안이 취약
